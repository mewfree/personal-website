<!doctype html><html lang="en"><head><title>Guide to Facebook Insights API - Damien Gonot</title><link rel="stylesheet" href="/main.css"><link rel="stylesheet" href="/katex.min.css"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="What is the Facebook Insights API?

The Facebook Insights API is what allows us to query results from the
Facebook Marketing platform. It basically includes any kind of statistic
that you can find in the Facebook‚Äôs Ads Manager.

Following Getting Started with Facebook Marketing API‚Äôs article, we‚Äô..."><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body class="bg-white dark:bg-black"><header class="bg-indigo-600 dark:bg-black text-center text-white p-8"><div class="text-4xl font-bold mb-4">Damien Gonot</div><div class="text-xl flex space-x-8 justify-center"><a href="/" class="hover:underline">Home</a> <a href="/blog" class="hover:underline">Blog</a> <a href="/notes" class="hover:underline">Notes</a> <a href="/about" class="hover:underline">About</a> <a id="theme" class="text-2xl hover:cursor-pointer hover:dark" onclick="toggleTheme()">üåù</a></div><script>function loadCss(e){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",`/highlight.${e}.css`),document.getElementsByTagName("head")[0].appendChild(t)}function toggleTheme(){"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.remove("dark"),document.getElementById("theme").innerText="üåù",loadCss(localStorage.theme="light")):(document.documentElement.classList.add("dark"),document.getElementById("theme").innerText="üåûÔ∏è",loadCss(localStorage.theme="dark"))}"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),document.getElementById("theme").innerText="üåûÔ∏è",loadCss("dark")):(document.documentElement.classList.remove("dark"),document.getElementById("theme").innerText="üåù",loadCss("light"))</script><script src="/highlight.js"></script><script defer="defer" src="/katex.min.js"></script><script defer="defer" src="/katex-auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("pre code").forEach(e=>{e.classList.remove("sourceCode"),0<e.classList.length&&e.classList.replace(e.classList[0],"language-"+e.classList[0]),hljs.highlightElement(e)}),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script></header><div class="prose prose-indigo dark:prose-invert dark:prose-a:text-indigo-400 max-w-3xl mx-auto p-8"><h1 class="text-center">Guide to Facebook Insights API</h1><div class="text-center">written on 2019-07-14</div><h2 id="what-is-the-facebook-insights-api">What is the Facebook Insights API?</h2><p>The Facebook Insights API is what allows us to query results from the Facebook Marketing platform. It basically includes any kind of statistic that you can find in the Facebook‚Äôs Ads Manager.</p><p>Following <a href="/blog/getting-started-with-facebook-marketing-api">Getting Started with Facebook Marketing API</a>‚Äôs article, we‚Äôll use the <code>facebook-python-business-sdk</code> Python package. Please refer to that article in order to get your <code>app id</code>, <code>app secret</code> and <code>access token</code>.</p><p>Note: I will be replacing confidential information with asterisks (<code>*</code>) in the code samples below.</p><h2 id="basic-data-fetching">Basic data fetching</h2><h3 id="account-level-data-fetching">Account-level data fetching</h3><p>The most basic way to get ‚Äúinsights‚Äù from the Facebook API looks like this:</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.api <span class="im">import</span> FacebookAdsApi</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.adobjects.adaccount <span class="im">import</span> AdAccount</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>app_id <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_ID&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>app_secret <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_SECRET&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_ACCESS_TOKEN&#39;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>FacebookAdsApi.init(app_id, app_secret, access_token)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights()</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>But as you can see, we didn‚Äôt specify any date range, columns or breakdowns. Facebook automatically picks the last 30 days date range, impressions and spend columns with no breakdown.</p><p>Result:</p><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">&lt;</span>AdsInsights<span class="op">&gt;</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;account_id&quot;</span>: <span class="st">&quot;****************&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_start&quot;</span>: <span class="st">&quot;2019-04-13&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_stop&quot;</span>: <span class="st">&quot;2019-05-12&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;impressions&quot;</span>: <span class="st">&quot;*****&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;spend&quot;</span>: <span class="st">&quot;****.**&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}]</span></code></pre></div><p>Also note that the highest level of insights one can get from the Facebook API is at the account level. If you manage multiple accounts and would like to aggregate the spend among all accounts, you‚Äôll have to query every account manually and sum it up yourself.</p><h3 id="other-level-data-fetching">Other level data fetching</h3><p>Getting campaign-level insights instead is really easy. We simply need to swap the <code>AdAccount</code> ad object for <code>Campaign</code>.</p><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.api <span class="im">import</span> FacebookAdsApi</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.adobjects.campaign <span class="im">import</span> Campaign</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>app_id <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_ID&#39;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>app_secret <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_SECRET&#39;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_ACCESS_TOKEN&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>FacebookAdsApi.init(app_id, app_secret, access_token)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> Campaign(<span class="st">&#39;*****************&#39;</span>).get_insights()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>Result:</p><div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">&lt;</span>AdsInsights<span class="op">&gt;</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;account_id&quot;</span>: <span class="st">&quot;****************&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;campaign_id&quot;</span>: <span class="st">&quot;******************&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_start&quot;</span>: <span class="st">&quot;2019-05-03&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_stop&quot;</span>: <span class="st">&quot;2019-06-01&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;impressions&quot;</span>: <span class="st">&quot;*****&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;spend&quot;</span>: <span class="st">&quot;****.**&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}]</span></code></pre></div><p>Notice how the <code>campaign_id</code> is now mentioned in the result.</p><p>For ad set level and ad level data, import <code>AdSet</code> or <code>Ad</code> from <code>facebook_business.adobjects.adset</code> and <code>facebook_business.adobjects.ad</code> respectively and use <code>AdSet(&lt;AdSetID&gt;).get_insights()</code> or <code>Ad(&lt;AdID&gt;).get_insights()</code> to fetch your insights.</p><h2 id="customizing-date-ranges-fields-sorting-and-more">Customizing date ranges, fields, sorting and more</h2><p>The queries listed above are fine but you probably want to get data from specific time ranges and for particular fields! This is what we‚Äôll cover in this section.</p><h3 id="customizing-the-date-range">Customizing the date range</h3><h4 id="using-date-presets">Using date presets</h4><p>Facebook offers a long list of different date presets that should cover a lot of use cases: - <code>today</code> - <code>yesterday</code> - <code>last_3d</code> - <code>last_7d</code> - <code>last_14d</code> - <code>last_28d</code> - <code>last_30d</code> - <code>last_90d</code> - <code>this_week_mon_today</code> - <code>this_week_sun_today</code> - <code>last_week_mon_sun</code> - <code>last_week_sun_sat</code> - <code>this_month</code> - <code>last_month</code> - <code>this_quarter</code> - <code>last_quarter</code> - <code>this_year</code> - <code>last_year</code> - <code>lifetime</code></p><p>Those date presets can be passed as parameters to our <code>get_insights()</code> query, see below as an example with <code>last_7d</code>:</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(...)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&#39;date_preset&#39;</span>: <span class="st">&#39;last_7d&#39;</span>}</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights(params <span class="op">=</span> params)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>The results will now only include data from the last 7 days üòä</p><h4 id="using-a-time-range">Using a time range</h4><p>If you want data from a specific time range not included in the presets above, you can also use a <code>since</code> date and an <code>until</code> date, with dates in the YYYY-MM-DD format.</p><div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(...)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&#39;time_range&#39;</span>: {<span class="st">&#39;since&#39;</span>: <span class="st">&#39;2019-01-01&#39;</span>, <span class="st">&#39;until&#39;</span>: <span class="st">&#39;2019-01-05&#39;</span>}}</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights(params <span class="op">=</span> params)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>You can confirm the query is working as the result includes a <code>date_start</code> and <code>date_stop</code>:</p><div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">&lt;</span>AdsInsights<span class="op">&gt;</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;account_id&quot;</span>: <span class="st">&quot;****************&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_start&quot;</span>: <span class="st">&quot;2019-01-01&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_stop&quot;</span>: <span class="st">&quot;2019-01-05&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;impressions&quot;</span>: <span class="st">&quot;*******&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;spend&quot;</span>: <span class="st">&quot;*****.**&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}]</span></code></pre></div><h3 id="customizing-the-fields">Customizing the fields</h3><h4 id="common-fields">Common fields</h4><p>In the same manner that we can pass different parameters to the <code>get_insights()</code> query, we can pass <code>fields</code> which is a list of the different fields we want to get from the Facebook Insights API. A complete list can be found in the <a href="https://developers.facebook.com/docs/marketing-api/insights/parameters">Facebook‚Äôs official documentation about parameters and fields</a>. Here is an example with common fields most marketers would like to get:</p><div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(...)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&#39;date_preset&#39;</span>: <span class="st">&#39;last_7d&#39;</span>}</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;account_name&#39;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;impressions&#39;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;clicks&#39;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cpm&#39;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ctr&#39;</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;spend&#39;</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> params, fields <span class="op">=</span> fields</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>And the result now includes the additional fields:</p><div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">&lt;</span>AdsInsights<span class="op">&gt;</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;account_name&quot;</span>: <span class="st">&quot;Damien Gonot tutorial account&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;clicks&quot;</span>: <span class="st">&quot;*****&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;cpm&quot;</span>: <span class="st">&quot;4.50&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ctr&quot;</span>: <span class="st">&quot;1.50&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_start&quot;</span>: <span class="st">&quot;2019-07-07&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;date_stop&quot;</span>: <span class="st">&quot;2019-07-13&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;impressions&quot;</span>: <span class="st">&quot;*******&quot;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;spend&quot;</span>: <span class="st">&quot;*****.**&quot;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>}]</span></code></pre></div><h4 id="actions-conversions-and-cost-per-action-cpa">Actions / Conversions and Cost per Action (CPA)</h4><p>Getting conversion data is a bit weird using Facebook Insights API, you have to include <code>actions</code> in the list of fields and it will return the entire list of actions that Facebook tracks. Here is an example:</p><div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(...)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&#39;date_preset&#39;</span>: <span class="st">&#39;last_7d&#39;</span>}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;account_name&#39;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;impressions&#39;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;clicks&#39;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cpm&#39;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ctr&#39;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;spend&#39;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;actions&#39;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> params, fields <span class="op">=</span> fields</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(insights)</span></code></pre></div><p>And the result:</p><div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">&lt;</span>AdsInsights<span class="op">&gt;</span> {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;account_name&quot;</span>: <span class="st">&quot;Damien Gonot tutorial account&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;actions&quot;</span>: [</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        (...)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;comment&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;****&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;link_click&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;******&quot;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;mobile_app_install&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;*****&quot;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;app_custom_event.fb_mobile_search&quot;</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;******&quot;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;app_custom_event.fb_mobile_add_to_cart&quot;</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;*****&quot;</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;action_type&quot;</span>: <span class="st">&quot;app_custom_event.fb_mobile_add_to_wishlist&quot;</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;value&quot;</span>: <span class="st">&quot;*****&quot;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        (...)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><p>Depending on your conversion setup, you‚Äôll get different results. To calculate your CPA (Cost per Action), you can either calculate it yourself or use Facebook‚Äôs calculated CPA.</p><p>First of all, getting the spend is pretty straightforward once you realize the <code>AdsInsights</code> object is in a list:</p><div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>spend <span class="op">=</span> insights[<span class="dv">0</span>][<span class="st">&#39;spend&#39;</span>]</span></code></pre></div><p>Getting the action count is a bit trickier as <code>actions</code> is a list of objects. I‚Äôll try to find <code>mobile_app_installs</code> as an example, replace with any action name you would like to get:</p><div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mobile_app_installs <span class="op">=</span> <span class="bu">next</span>(action <span class="cf">for</span> action <span class="kw">in</span> insights[<span class="dv">0</span>][<span class="st">&#39;actions&#39;</span>] <span class="cf">if</span> action[<span class="st">&#39;action_type&#39;</span>] <span class="op">==</span> <span class="st">&#39;mobile_app_install&#39;</span>)[<span class="st">&#39;value&#39;</span>]</span></code></pre></div><p>Tying everything together knowing that numbers returned by Facebook Insights API are actually strings:</p><div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.api <span class="im">import</span> FacebookAdsApi</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> facebook_business.adobjects.adaccount <span class="im">import</span> AdAccount</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>app_id <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_ID&#39;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>app_secret <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_APP_SECRET&#39;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> <span class="st">&#39;REPLACE_BY_YOUR_ACCESS_TOKEN&#39;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>FacebookAdsApi.init(app_id, app_secret, access_token)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&#39;date_preset&#39;</span>: <span class="st">&#39;last_7d&#39;</span>}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;account_name&#39;</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;impressions&#39;</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;clicks&#39;</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;cpm&#39;</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;ctr&#39;</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;spend&#39;</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;actions&#39;</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>insights <span class="op">=</span> AdAccount(<span class="st">&#39;act_****************&#39;</span>).get_insights(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> params, fields <span class="op">=</span> fields</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>spend <span class="op">=</span> insights[<span class="dv">0</span>][<span class="st">&#39;spend&#39;</span>]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>mobile_app_installs <span class="op">=</span> <span class="bu">next</span>(action <span class="cf">for</span> action <span class="kw">in</span> insights[<span class="dv">0</span>][<span class="st">&#39;actions&#39;</span>] <span class="cf">if</span> action[<span class="st">&#39;action_type&#39;</span>] <span class="op">==</span> <span class="st">&#39;mobile_app_install&#39;</span>)[<span class="st">&#39;value&#39;</span>]</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>cpa <span class="op">=</span> <span class="bu">float</span>(spend)<span class="op">/</span><span class="bu">int</span>(mobile_app_installs)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;CPA:&#39;</span>, <span class="bu">round</span>(cpa, <span class="dv">2</span>))</span></code></pre></div><p>That‚Äôs all for now but there are still a few details to cover: - an alternative way to fetch CPA - calculating ROAS (Return on Ad Spend) - sorting the results - getting the data on different levels - breakdown by time/day and other factors - attribution windows</p><p>Thank you for reading and <del>stay tuned for part 2</del>! Do not hesitate to <a href="/about">contact me</a> if you still have any questions.</p><p><strong>2020-01-21 Update: I‚Äôve finally published the <a href="/blog/guide-facebook-insights-api-2">part 2 of Guide to Facebook Insights API</a>!</strong></p></div></body></html>